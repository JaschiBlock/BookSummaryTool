<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<title>Zeichenz√§hler mit Kapitel-Navigation & Tour</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  body { font-family: system-ui, sans-serif; margin: 20px; color: #111; }
  h1 { margin-bottom: 1rem; }
  input, textarea, select, button {
    font: inherit; border: 1px solid #ccc; border-radius: 6px; padding: 8px;
  }
  textarea { width: 100%; min-height: 50vh; resize: vertical; }

  .chapter-ctrls { display: flex; align-items: center; gap: 8px; }
  .chapter-ctrls .arrow {
    font-size: 1.4rem; padding: 8px 14px; cursor: pointer;
    background: #fff; border: 1px solid #999; border-radius: 8px;
  }
  .chapter-ctrls .arrow:disabled { opacity: .5; cursor: default; }

  .btn { background: #111; color: #fff; border: none; cursor: pointer; }
  .btn.secondary { background: #fff; color: #111; border: 1px solid #999; }
  .meta { font-size: .9em; color: #555; }

  /* HUD */
  #hud {
    position: fixed; right: 16px; top: 16px; background: #fff;
    border: 1px solid #ccc; border-radius: 8px; padding: 12px;
    box-shadow: 0 4px 14px rgba(0,0,0,.15); z-index: 1000;
  }
  #hud.hidden { display: none; }
  #hud .mini-btn { padding: 6px 10px; font-size: 1rem; }
  #hud .arrow { font-size: 1.4rem; padding: 8px 14px; }

  /* Tour Overlay */
  .tour { position: fixed; inset: 0; background: rgba(0,0,0,.5); display: none; z-index: 2000; }
  .tour.active { display: block; }
  .tour .spot {
    position: absolute; border: 2px solid #0a84ff; border-radius: 8px;
    box-shadow: 0 0 0 9999px rgba(0,0,0,.5);
  }
  .tour .box {
    position: absolute; background: #111; color: #fff;
    border-radius: 8px; padding: 12px; max-width: 320px;
  }
  .tour .actions { margin-top: 8px; text-align: right; }
</style>
</head>
<body>
<h1>Zeichenz√§hler</h1>

<label>Kapitelanzahl</label>
<input id="chapters" type="number" value="30" min="1" />

<label>Aktuelles Kapitel</label>
<div class="chapter-ctrls">
  <button id="prevChapter" class="arrow">‚Üê</button>
  <input id="currentChapter" type="number" value="1" min="1" style="width:60px" />
  <button id="nextChapter" class="arrow">‚Üí</button>
</div>

<label>Gesamt-Minimum Zeichen</label>
<input id="minTotal" type="number" value="1100" min="0" />

<label>Gesamt-Maximum Zeichen</label>
<input id="maxTotal" type="number" value="1500" min="0" />

<div class="meta">Linear: Bis Kapitel k sind k/N des Gesamt-Min/Max erlaubt.</div>

<label>Text</label>
<textarea id="text" placeholder="Schreibe hier..."></textarea>

<!-- Speicherfunktionen -->
<h3>Projekt sichern & laden</h3>
<button id="saveFile" class="btn secondary">üíæ Projekt-Sicherung als Datei speichern</button>
<div class="meta">Erstellt eine Datei mit deinem Fortschritt zum sp√§teren Laden.</div>
<input id="loadFileInput" type="file" accept="application/json" style="display:none" />
<button id="loadFile" class="btn secondary">üìÇ Gespeichertes Projekt laden</button>
<div class="meta">L√§dt eine gespeicherte Datei und ersetzt den aktuellen Stand.</div>

<!-- HUD -->
<div id="hud">
  <div><strong>HUD</strong> <button id="hideHud" class="mini-btn">Hide</button></div>
  <div>Zeichen: <span id="charCount">0</span></div>
  <div>Kapitel: 
    <button id="hudPrev" class="arrow">‚Üê</button>
    <span id="hudChapter">1 / 30</span>
    <button id="hudNext" class="arrow">‚Üí</button>
  </div>
  <div>Delta: <span id="deltaInfo">0</span></div>
</div>

<!-- Tour -->
<div id="tour" class="tour">
  <div id="tourSpot" class="spot"></div>
  <div id="tourBox" class="box">
    <div id="tourText"></div>
    <div class="actions">
      <label><input type="checkbox" id="skipNext"> Einf√ºhrung nicht mehr automatisch anzeigen</label><br>
      <button id="tourPrev" class="btn secondary">Zur√ºck</button>
      <button id="tourNext" class="btn">Weiter</button>
      <button id="tourEnd" class="btn secondary">Beenden</button>
    </div>
  </div>
</div>

<script>
const textEl = document.getElementById('text');
const chaptersEl = document.getElementById('chapters');
const currentEl = document.getElementById('currentChapter');
const prevBtn = document.getElementById('prevChapter');
const nextBtn = document.getElementById('nextChapter');
const charCountEl = document.getElementById('charCount');
const hud = document.getElementById('hud');
const hideHudBtn = document.getElementById('hideHud');
const hudPrev = document.getElementById('hudPrev');
const hudNext = document.getElementById('hudNext');
const hudChapter = document.getElementById('hudChapter');
const deltaInfo = document.getElementById('deltaInfo');

let tourIndex = 0;
const tourEl = document.getElementById('tour');
const tourSpot = document.getElementById('tourSpot');
const tourBox = document.getElementById('tourBox');
const tourText = document.getElementById('tourText');
const skipNext = document.getElementById('skipNext');
const steps = [
  { sel: '#chapters', text: 'Hier stellst du die Kapitelanzahl ein.' },
  { sel: '#currentChapter', text: 'Hier das aktuelle Kapitel ‚Äì du kannst mit den Pfeilen wechseln.' },
  { sel: '#text', text: 'Hier schreibst oder f√ºgst du deinen Text ein.' },
  { sel: '#saveFile', text: 'Speichere dein Projekt als Datei auf deinem Ger√§t.' },
  { sel: '#loadFile', text: 'Lade ein gespeichertes Projekt, um weiterzumachen.' },
  { sel: '#hud', text: 'Das HUD zeigt dir Zeichenanzahl, Kapitel und Delta in Echtzeit.' }
];

function updateCounts() {
  const count = (textEl.value || '').replace(/\r?\n/g,'').length;
  charCountEl.textContent = count;
  const chapters = parseInt(chaptersEl.value,10);
  const current = parseInt(currentEl.value,10);
  hudChapter.textContent = current + ' / ' + chapters;
  deltaInfo.textContent = '...'; // hier Delta berechnen
}
function changeChapter(delta) {
  const max = parseInt(chaptersEl.value,10);
  let cur = parseInt(currentEl.value,10);
  cur = Math.min(max, Math.max(1, cur + delta));
  currentEl.value = cur;
  updateCounts();
}
prevBtn.onclick = () => changeChapter(-1);
nextBtn.onclick = () => changeChapter(1);
hudPrev.onclick = () => changeChapter(-1);
hudNext.onclick = () => changeChapter(1);
textEl.oninput = updateCounts;
chaptersEl.oninput = updateCounts;
currentEl.oninput = updateCounts;
hideHudBtn.onclick = () => hud.classList.toggle('hidden');

document.getElementById('saveFile').onclick = () => {
  const data = {
    text: textEl.value,
    chapters: chaptersEl.value,
    current: currentEl.value
  };
  const blob = new Blob([JSON.stringify(data)], {type: 'application/json'});
  const a = document
